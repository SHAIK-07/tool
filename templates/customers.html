{% extends "base.html" %}

{% block title %}Customer Management | Sunmax Renewables{% endblock %}

{% block head %}
<style>
    /* Customer Management Styles */
    .customer-container {
        max-width: 1200px;
        margin: 0 auto;
        overflow-y: visible; /* Allow content to overflow and be scrollable */
        height: auto; /* Allow content to determine height */
    }

    .page-header {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
    }

    .page-header h2 {
        font-size: 24px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
    }

    .page-header p {
        color: var(--text-secondary);
        font-size: 14px;
    }

    /* Form section */
    .form-section {
        background-color: var(--card-bg);
        border-radius: 8px;
        box-shadow: var(--standard-shadow);
        padding: 20px;
        margin-bottom: 30px;
    }

    .form-section h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: var(--text-primary);
        font-size: 1.2rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-field {
        display: flex;
        flex-direction: column;
    }

    .form-field label {
        margin-bottom: 5px;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .form-field input,
    .form-field select {
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--input-bg);
        color: var(--input-text);
    }

    .add-btn {
        background-color: var(--btn-primary-bg);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        width: 100%;
        margin-top: 10px;
        transition: all 0.2s ease;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .add-btn:hover {
        background-color: var(--btn-primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--medium-shadow);
    }

    /* Current inventory section */
    .current-inventory {
        background-color: var(--card-bg);
        border-radius: 8px;
        box-shadow: var(--standard-shadow);
        padding: 20px;
    }

    .inventory-header {
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .inventory-header h3 {
        margin: 0;
        color: var(--text-primary);
    }

    .header-actions {
        display: flex;
        gap: 15px;
    }

    .count-badge {
        display: inline-block;
        background-color: var(--btn-primary-bg);
        color: white;
        font-size: 0.8rem;
        font-weight: normal;
        padding: 2px 8px;
        border-radius: 12px;
        margin-left: 10px;
        vertical-align: middle;
    }

    .export-btn {
        background-color: var(--btn-primary-bg);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
    }

    .export-btn:hover {
        background-color: var(--btn-primary-hover);
    }

    /* Search panel */
    .search-panel {
        background-color: var(--bg-tertiary);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .search-container {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .search-container input {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--input-bg);
        color: var(--input-text);
    }

    .btn.primary {
        background-color: var(--btn-primary-bg);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn.primary:hover {
        background-color: var(--btn-primary-hover);
    }

    .filter-select {
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--input-bg);
        color: var(--input-text);
    }

    /* Inventory info */
    .inventory-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background-color: var(--bg-tertiary);
        border-radius: 5px;
    }

    .inventory-count {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    /* Inventory table */
    .inventory-table-container {
        width: 100%;
        margin: 0 auto 1rem;
        position: relative;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-shadow: var(--standard-shadow);
        overflow: hidden;
    }

    .inventory-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
    }

    .inventory-table th,
    .inventory-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-primary);
    }

    .inventory-table th {
        background-color: var(--btn-primary-bg);
        color: white;
        font-weight: bold;
        padding: 0.6rem 0.5rem;
        position: sticky;
        top: 0;
        z-index: 10;
        font-size: 0.9rem;
        text-align: center;
    }

    .inventory-table tr {
        background-color: var(--card-bg);
    }

    .inventory-table tr:nth-child(even) {
        background-color: rgba(0, 0, 0, 0.02);
    }

    .inventory-table tr:hover {
        background-color: rgba(76, 175, 80, 0.05);
    }

    /* No inventory message */
    .no-inventory {
        text-align: center;
        padding: 30px;
        color: var(--text-secondary);
        background-color: rgba(0, 0, 0, 0.02);
        border-radius: 8px;
        border: 1px dashed var(--border-color);
    }

    /* Customer Filters Styling */
    .customer-filters {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
        background-color: var(--bg-tertiary);
        padding: 15px;
        border-radius: 8px;
        box-shadow: var(--standard-shadow);
    }

    .search-row {
        width: 100%;
    }

    .search-row .search-box {
        width: 100%;
        max-width: 100%;
        display: flex;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        overflow: hidden;
        box-shadow: var(--standard-shadow);
        transition: var(--box-transition), border-color 0.3s ease;
    }

    .search-row .search-box input {
        width: 100%;
        padding: 12px 15px;
        border: none;
        outline: none;
        font-size: 16px;
        background-color: var(--input-bg);
        color: var(--input-text);
        transition: var(--standard-transition);
    }

    /* Ensure search input is visible in dark mode */
    [data-theme="dark"] .search-row .search-box input {
        color: white;
        background-color: #333;
    }

    /* Fix placeholder text color in dark mode */
    [data-theme="dark"] .search-row .search-box input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    .search-row .search-box button {
        background-color: var(--btn-primary-bg);
        color: var(--btn-primary-text);
        border: none;
        padding: 0 20px;
        cursor: pointer;
        transition: var(--standard-transition);
    }

    .search-row .search-box button:hover {
        background-color: var(--accent-secondary);
    }

    .filter-row {
        width: 100%;
    }

    .filter-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        width: 100%;
    }

    .filter-select,
    .filter-options select {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--input-bg);
        color: var(--input-text);
        min-width: 180px;
        font-size: 14px;
        transition: var(--standard-transition), border-color 0.3s ease;
    }

    /* Ensure select options are visible in dark mode */
    [data-theme="dark"] .filter-options select {
        color: white;
        background-color: #333;
        border-color: #555;
    }

    [data-theme="dark"] .filter-options select option {
        background-color: #333;
        color: white;
    }

    .filter-options .export-btn,
    .filter-options .filter-btn {
        padding: 8px 15px;
        background-color: var(--btn-primary-bg);
        color: var(--btn-primary-text);
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: var(--all-transitions);
        box-shadow: var(--standard-shadow);
    }

    .filter-options .export-btn:hover,
    .filter-options .filter-btn:hover {
        background-color: var(--accent-secondary);
        transform: translateY(-2px);
        box-shadow: var(--medium-shadow);
    }

    /* Count Badge Styling */
    .count-badge {
        display: inline-block;
        background-color: var(--btn-primary-bg);
        color: var(--btn-primary-text);
        font-size: 14px;
        font-weight: normal;
        padding: 2px 8px;
        border-radius: 12px;
        margin-left: 10px;
        vertical-align: middle;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Customer Form Styles */
    .customer-form-container {
        background-color: var(--card-bg);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 8px var(--shadow-color);
        margin-bottom: 2rem;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid var(--border-color);
    }

    .customer-form-container h3 {
        margin-bottom: 1.5rem;
        color: var(--text-primary);
        text-align: center;
        font-size: 1.5rem;
        transition: color 0.3s ease;
    }

    .form-row {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 1rem;
    }

    .form-group {
        flex: 1;
    }

    form label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text-primary);
        transition: color 0.3s ease;
    }

    form input,
    form select,
    form textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        font-size: 1rem;
        background-color: var(--input-bg);
        color: var(--input-text);
        transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }

    form input:focus,
    form select:focus,
    form textarea:focus {
        border-color: var(--accent-primary);
        outline: none;
        box-shadow: 0 0 0 2px var(--shadow-color);
    }

    .submit-btn {
        margin-top: 1.5rem;
        padding: 0.75rem;
        background-color: var(--btn-primary-bg);
        color: var(--btn-primary-text);
        border: none;
        width: 100%;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
        font-weight: bold;
    }

    .submit-btn:hover {
        background-color: var(--accent-secondary);
    }

    /* Current Customers Styles */
    .current-customers {
        background-color: var(--card-bg);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: var(--medium-shadow);
        transition: var(--box-transition);
        border: 1px solid var(--border-color);
    }

    .customers-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .customers-header h3 {
        margin: 0;
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .search-filter-row {
        display: flex;
        flex-wrap: nowrap;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
        justify-content: space-between;
        background-color: var(--bg-tertiary);
        padding: 10px 15px;
        border-radius: 8px;
    }

    .search-box {
        display: flex;
        width: 300px;
        flex-shrink: 0;
    }

    .search-input {
        flex-grow: 1;
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px 0 0 6px;
        font-size: 14px;
        background-color: var(--input-bg);
        color: var(--input-text);
        height: 38px;
        box-sizing: border-box;
    }

    .search-btn {
        background-color: var(--btn-primary-bg);
        color: white;
        border: none;
        padding: 0 15px;
        border-radius: 0 6px 6px 0;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .search-btn:hover {
        background-color: #0b5ed7;
        transform: translateY(-2px);
    }

    .filter-select {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--input-bg);
        color: var(--input-text);
        height: 38px;
        min-width: 140px;
    }

    .filter-btn {
        background-color: var(--btn-secondary-bg);
        color: var(--btn-secondary-text);
        border: 1px solid var(--border-color);
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        height: 38px;
        display: flex;
        align-items: center;
        gap: 5px;
        white-space: nowrap;
    }

    .filter-btn:hover {
        background-color: var(--accent-tertiary);
        transform: translateY(-2px);
    }

    .export-btn {
        background-color: var(--success-color);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.3s ease, transform 0.2s ease;
        height: 38px;
        white-space: nowrap;
    }

    .export-btn:hover {
        background-color: #157347;
        transform: translateY(-2px);
    }

    .inventory-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background-color: var(--card-bg);
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .customer-count {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    /* Table styles */
    .customer-table-container {
        width: 100%;
        margin: 0 auto 1rem;
        position: relative;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-shadow: var(--standard-shadow);
        overflow: hidden;
    }

    .customer-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border-radius: 5px;
        overflow: hidden;
    }

    .customer-table th, .customer-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-primary);
        transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .customer-table th {
        background-color: var(--btn-primary-bg);
        color: white;
        font-weight: bold;
        border-bottom: 2px solid var(--border-color);
        padding: 0.6rem 0.5rem;
        position: sticky;
        top: 0;
        z-index: 10;
        font-size: 0.9rem;
        text-align: center;
    }

    .customer-table tr {
        background-color: var(--card-bg);
    }

    .customer-table tr:nth-child(even) {
        background-color: rgba(0, 0, 0, 0.02);
    }

    .customer-table tr:hover {
        background-color: rgba(76, 175, 80, 0.05);
    }

    /* Status badges */
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        display: inline-block;
        text-align: center;
    }

    .status-paid {
        background-color: #d4edda;
        color: #155724;
    }

    .status-partial {
        background-color: #fff3cd;
        color: #856404;
    }

    .status-unpaid {
        background-color: #f8d7da;
        color: #721c24;
    }

    /* Action buttons */
    .action-btn-group {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        gap: 5px;
        min-width: 180px; /* Ensure enough space for all buttons */
    }
    
    .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: inline-flex !important; /* Force display as flex */
        align-items: center;
        justify-content: center;
        color: white !important;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        margin: 0 2px;
        flex-shrink: 0; /* Prevent buttons from shrinking */
        visibility: visible !important; /* Force visibility */
        opacity: 1 !important; /* Force opacity */
    }
    
    /* Specific button colors */
    .action-btn.view {
        background-color: var(--accent-tertiary, #007bff);
    }
    
    .action-btn.edit {
        background-color: var(--accent-tertiary, #007bff);
    }
    
    .action-btn.pdf {
        background-color: var(--info-color, #17a2b8);
    }
    
    .action-btn.download {
        background-color: var(--success-color, #28a745);
    }
    
    .action-btn.delete {
        background-color: var(--danger-color, #dc3545);
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .action-btn.view:hover {
        background-color: var(--accent-secondary);
    }

    .action-btn.delete:hover {
        background-color: #dc3545;
    }

    .pdf-btn {
        background-color: var(--danger-color);
    }

    .download-btn {
        background-color: var(--success-color);
    }

    .edit-btn {
        background-color: var(--accent-tertiary);
        color: var(--text-primary);
    }

    .delete-btn {
        background-color: var(--danger-color);
    }

    .view-btn:hover, .pdf-btn:hover, .download-btn:hover, .edit-btn:hover, .delete-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: var(--medium-shadow);
    }

    /* Text color classes */
    .text-success {
        color: #28a745;
        font-weight: 500;
    }

    .text-warning {
        color: #ffc107;
        font-weight: 500;
    }

    .text-danger {
        color: #dc3545;
        font-weight: 500;
    }

    /* Customer form container */
    .customer-form-container {
        background-color: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        padding: 25px;
        margin-bottom: 30px;
        max-width: 900px;
    }

    .customer-form-container h3 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #333;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
    }

    .form-field {
        margin-bottom: 0;
    }

    .form-field label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
        font-size: 1rem;
    }

    .form-field input,
    .form-field select,
    .form-field textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: #fff;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    .form-field textarea {
        height: 100px;
        resize: vertical;
    }

    .add-btn {
        background-color: #000;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        width: auto;
        margin-top: 15px;
        transition: background-color 0.2s;
        font-size: 1rem;
    }

    .add-btn:hover {
        background-color: #333;
    }

    /* Pagination */
    .pagination-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding: 10px;
        background-color: var(--card-bg);
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .pagination {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .page-link {
        padding: 8px 12px;
        background-color: var(--btn-primary-bg);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 0.9rem;
        transition: background-color 0.2s;
    }

    .page-link:hover {
        background-color: var(--btn-primary-hover);
    }

    .page-link.active {
        background-color: var(--accent-secondary);
        color: white;
    }

    .page-link.disabled {
        background-color: #ccc;
        cursor: not-allowed;
        opacity: 0.7;
        pointer-events: none;
    }

    .items-per-page {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .items-per-page label {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .items-per-page select {
        padding: 6px 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--input-bg);
        color: var(--input-text);
    }

    /* Success and error messages */
    .success-message {
        margin-top: 1.5rem;
        padding: 1rem;
        background-color: var(--success-color);
        color: white;
        border-radius: 5px;
        display: flex;
        align-items: center;
        opacity: 0.9;
        transition: background-color 0.3s ease;
    }

    .success-icon {
        font-size: 1.5rem;
        margin-right: 1rem;
    }

    .error-message {
        margin-top: 1.5rem;
        padding: 1rem;
        background-color: var(--danger-color);
        color: white;
        border-radius: 5px;
        display: flex;
        align-items: center;
        opacity: 0.9;
        transition: background-color 0.3s ease;
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: auto;
        justify-content: center;
        align-items: center;
    }

    .modal.hidden {
        display: none !important;
    }

    .modal-content {
        background-color: var(--modal-bg);
        margin: 0 auto;
        padding: 2rem;
        border-radius: 8px;
        max-width: 600px;
        position: relative;
        box-shadow: var(--modal-shadow);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .modal-header {
        margin-bottom: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 1rem;
        position: relative;
        transition: border-color 0.3s ease;
    }

    .modal-header h3 {
        margin: 0;
        color: var(--text-primary);
        transition: color 0.3s ease;
    }

    .close {
        position: absolute;
        top: 0;
        right: 0;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-secondary);
        transition: color 0.3s ease;
    }

    .close:hover {
        color: var(--text-primary);
    }

    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        border-top: 1px solid var(--border-color);
        padding-top: 1rem;
        margin-top: 1.5rem;
        transition: border-color 0.3s ease;
    }

    .cancel-btn {
        padding: 0.75rem 1.5rem;
        background-color: var(--text-muted);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .cancel-btn:hover {
        opacity: 0.9;
    }

    .delete-confirm-btn {
        padding: 0.75rem 1.5rem;
        background-color: var(--danger-color);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        font-weight: bold;
    }

    .delete-confirm-btn:hover {
        opacity: 0.9;
    }

    /* No data message */
    .no-data-message {
        text-align: center;
        padding: 30px;
        color: var(--text-secondary);
        background-color: rgba(0, 0, 0, 0.02);
        border-radius: 8px;
        border: 1px dashed var(--border-color);
    }

    /* Custom popup styles */
    .custom-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .custom-popup.show {
        opacity: 1;
    }

    .popup-content {
        background-color: var(--modal-bg);
        border-radius: 8px;
        box-shadow: var(--large-shadow);
        width: 90%;
        max-width: 500px;
        transform: translateY(20px);
        transition: transform 0.3s ease;
        overflow: hidden;
    }

    .custom-popup.show .popup-content {
        transform: translateY(0);
    }

    .popup-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        background-color: var(--btn-primary-bg);
        color: white;
    }

    .popup-header h3 {
        margin: 0;
        font-size: 1.2rem;
    }

    .popup-body {
        padding: 1.5rem;
        max-height: 60vh;
        overflow-y: auto;
    }

    .popup-message {
        color: var(--text-primary);
    }

    .popup-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
    }

    .popup-btn {
        padding: 0.5rem 1rem;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: var(--all-transitions);
    }

    .popup-btn.confirm {
        background-color: var(--btn-primary-bg);
        color: white;
    }

    .popup-btn.confirm:hover {
        background-color: var(--accent-secondary);
    }

    .popup-btn.cancel {
        background-color: var(--text-muted);
        color: white;
    }

    .popup-btn.cancel:hover {
        opacity: 0.9;
    }
</style>
{% endblock %}

{% block content %}
<div class="customer-container">
    <div class="page-header">
        <h2>Customer Management</h2>
        <p>Add new customers and track payment status</p>
    </div>

    <div class="customer-form-container">
        <h3>Add New Customer</h3>

        <form id="add-customer-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="date">Date:</label>
                    <input type="date" id="date" name="date" class="form-control" required value="{{ today }}">
                </div>
                <div class="form-group">
                    <label for="customer_name">Customer Name:</label>
                    <input type="text" id="customer_name" name="customer_name" class="form-control" required placeholder="Enter customer name">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="phone_no">Phone Number:</label>
                    <input type="text" id="phone_no" name="phone_no" class="form-control" required placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label for="address">Address:</label>
                    <input type="text" id="address" name="address" class="form-control" placeholder="Enter address">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="product_description">Product Description:</label>
                    <textarea id="product_description" name="product_description" class="form-control" placeholder="Enter product description"></textarea>
                </div>
                <div class="form-group">
                    <label for="payment_method">Payment Method:</label>
                    <select id="payment_method" name="payment_method" class="form-control">
                        <option value="Cash">Cash</option>
                        <option value="UPI">UPI</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Cheque">Cheque</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="payment_status">Payment Status:</label>
                    <select id="payment_status" name="payment_status" class="form-control">
                        <option value="Unpaid">Unpaid</option>
                        <option value="Partially Paid">Partially Paid</option>
                        <option value="Fully Paid">Fully Paid</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="total_amount">Total Amount:</label>
                    <input type="number" id="total_amount" name="total_amount" class="form-control" required placeholder="Enter total amount">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="amount_paid">Amount Paid:</label>
                    <input type="number" id="amount_paid" name="amount_paid" class="form-control" value="0.00">
                </div>
                <div class="form-group">
                    <!-- Empty field to maintain grid layout -->
                </div>
            </div>

            <button type="button" id="add-customer-btn" class="submit-btn">
                Add Customer to System
            </button>
        </form>

        {% if message %}
        <div class="success-message">
            <i class="success-icon">✓</i>
            <p>{{ message }}</p>
        </div>
        {% endif %}

        {% if error %}
        <div class="error-message">
            <i class="error-icon">✗</i>
            <p>{{ error }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Current Customers Section -->
    <div class="current-inventory">
        <h3>Current Customers <span class="count-badge">{{ customers|length }}</span></h3>

        <!-- Search and filter controls -->
        <div class="inventory-table-container">
            <div class="search-filter-row">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search by customer name, phone or code..." value="{{ search_query }}">
                    <button class="search-btn" id="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="filter-options">
                    <select id="status-filter" class="filter-select">
                        <option value="all" {% if current_status == 'all' %}selected{% endif %}>All Statuses</option>
                        <option value="Fully Paid" {% if current_status == 'Fully Paid' %}selected{% endif %}>Fully Paid</option>
                        <option value="Partially Paid" {% if current_status == 'Partially Paid' %}selected{% endif %}>Partially Paid</option>
                        <option value="Unpaid" {% if current_status == 'Unpaid' %}selected{% endif %}>Unpaid</option>
                    </select>
                    <button id="export-excel-btn" class="export-btn" onclick="exportCustomersToExcel()">
                        <i class="fas fa-file-export"></i> Export to Excel
                    </button>
                </div>
            </div>

            {% if customers %}
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Date</th>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Total Amount (₹)</th>
                        <th>Amount Paid (₹)</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                    <tr id="row-{{ customer.id }}" data-customer-id="{{ customer.id }}">
                        <td>{{ customer.customer_code }}</td>
                        <td>{{ customer.date.strftime('%d-%m-%Y') if customer.date.strftime else customer.date }}</td>
                        <td>{{ customer.customer_name }}</td>
                        <td>{{ customer.phone_no }}</td>
                        <td>
                            <span class="view-content">₹{{ customer.total_amount }}</span>
                            <div class="edit-content" style="display: none;">
                                <input type="number" class="edit-input" id="total-amount-{{ customer.id }}" value="{{ customer.total_amount }}" step="0.01">
                            </div>
                        </td>
                        <td>
                            <span class="view-content">₹{{ customer.amount_paid }}</span>
                            <div class="edit-content" style="display: none;">
                                <input type="number" class="edit-input" id="amount-paid-{{ customer.id }}" value="{{ customer.amount_paid }}" step="0.01">
                            </div>
                        </td>
                        <td>
                            <span class="view-content status-badge {% if customer.payment_status == 'Fully Paid' %}status-paid{% elif customer.payment_status == 'Partially Paid' %}status-partial{% else %}status-unpaid{% endif %}">
                                {{ customer.payment_status }}
                            </span>
                            <div class="edit-content" style="display: none;">
                                <select class="edit-input" id="payment-status-{{ customer.id }}">
                                    <option value="Fully Paid" {% if customer.payment_status == 'Fully Paid' %}selected{% endif %}>Fully Paid</option>
                                    <option value="Partially Paid" {% if customer.payment_status == 'Partially Paid' %}selected{% endif %}>Partially Paid</option>
                                    <option value="Unpaid" {% if customer.payment_status == 'Unpaid' %}selected{% endif %}>Unpaid</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            <div class="action-btn-group">
                                <a href="/customer/{{ customer.id }}" class="action-btn view" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <button type="button" class="action-btn edit" title="Edit Payment" onclick="toggleEditMode({{ customer.id }})">
                                    <i class="fas fa-edit"></i>
                                </button>
                        
                                <button type="button" class="action-btn save" title="Save Changes" onclick="saveCustomerChanges({{ customer.id }})" style="display: none; background-color: #28a745;">
                                    <i class="fas fa-save"></i>
                                </button>
                                <button type="button" class="action-btn cancel" title="Cancel" onclick="cancelEdit({{ customer.id }})" style="display: none; background-color: #6c757d;">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button type="button" class="action-btn delete" title="Delete Customer" onclick="showDeleteModal('{{ customer.id }}', '{{ customer.customer_name }}')">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Pagination controls -->
            <div class="pagination-controls">
                <div class="pagination">
                    <a href="/customers?page=1&status={{ current_status }}&search={{ search_query }}" class="page-btn {% if page == 1 %}disabled{% endif %}">
                        <i class="fas fa-angle-double-left"></i>
                    </a>
                    <a href="/customers?page={{ page-1 }}&status={{ current_status }}&search={{ search_query }}" class="page-btn {% if page == 1 %}disabled{% endif %}">
                        <i class="fas fa-angle-left"></i>
                    </a>

                    {% set start_page = page - 2 if page > 2 else 1 %}
                    {% set end_page = page + 2 if page + 2 < total_pages else total_pages %}

                    {% for p in range(start_page, end_page + 1) %}
                    <a href="/customers?page={{ p }}&status={{ current_status }}&search={{ search_query }}" class="page-btn {% if p == page %}active{% endif %}">{{ p }}</a>
                    {% endfor %}

                    <a href="/customers?page={{ page+1 }}&status={{ current_status }}&search={{ search_query }}" class="page-btn {% if page == total_pages %}disabled{% endif %}">
                        <i class="fas fa-angle-right"></i>
                    </a>
                    <a href="/customers?page={{ total_pages }}&status={{ current_status }}&search={{ search_query }}" class="page-btn {% if page == total_pages %}disabled{% endif %}">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                </div>

                <div class="items-per-page">
                    <form class="items-per-page-form" action="/customers" method="get">
                        <label for="limit">Items per page:</label>
                        <select id="limit" name="limit" onchange="this.form.submit()">
                            <option value="10" {% if limit == 10 %}selected{% endif %}>10</option>
                            <option value="25" {% if limit == 25 %}selected{% endif %}>25</option>
                            <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                            <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
                        </select>
                        <input type="hidden" name="page" value="1">
                        <input type="hidden" name="status" value="{{ current_status }}">
                        <input type="hidden" name="search" value="{{ search_query }}">
                    </form>
                </div>
            </div>
            {% else %}
            <div class="no-inventory">
                <p>No customers found. Add your first customer using the form above.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <span class="close" onclick="closeDeleteModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete <span id="delete-customer-name"></span>?</p>
            <p class="warning-text">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
            <button id="confirm-delete-btn" class="delete-confirm-btn">Delete</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set today's date as default for new customer
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;

        // Add item form submission handler
        document.getElementById('add-customer-btn').addEventListener('click', addNewCustomer);

        // Auto-fill amount paid when payment status changes
        const paymentStatusSelect = document.getElementById('payment_status');
        const totalAmountInput = document.getElementById('total_amount');
        const amountPaidInput = document.getElementById('amount_paid');

        // Function to update amount paid based on payment status
        function updateAmountPaid() {
            if (paymentStatusSelect.value === 'Fully Paid' && totalAmountInput.value) {
                // If status is "Fully Paid", set amount paid equal to total amount
                amountPaidInput.value = totalAmountInput.value;

                // Show a visual feedback
                amountPaidInput.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
                setTimeout(() => {
                    amountPaidInput.style.backgroundColor = '';
                }, 1000);
            } else if (paymentStatusSelect.value === 'Unpaid') {
                // If status is "Unpaid", set amount paid to 0
                amountPaidInput.value = '0.00';

                // Show a visual feedback
                amountPaidInput.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                setTimeout(() => {
                    amountPaidInput.style.backgroundColor = '';
                }, 1000);
            }
        }

        // Add event listeners
        paymentStatusSelect.addEventListener('change', updateAmountPaid);
        totalAmountInput.addEventListener('input', function() {
            if (paymentStatusSelect.value === 'Fully Paid') {
                amountPaidInput.value = totalAmountInput.value;
            }
        });

        // Customer count badge is now handled by the template

        // Handle form submission on Enter key
        document.getElementById('add-customer-form').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addNewCustomer();
            }
        });

        // Function to add a new customer using AJAX
        function addNewCustomer() {
            // Show loading state
            const addButton = document.getElementById('add-customer-btn');
            const originalButtonText = addButton.innerHTML;

            // Validate form fields
            const customerName = document.getElementById('customer_name').value.trim();
            const phoneNo = document.getElementById('phone_no').value.trim();
            const totalAmount = document.getElementById('total_amount').value.trim();
            const date = document.getElementById('date').value.trim();

            // Check required fields
            if (!customerName) {
                showCustomPopup('Error', 'Customer name is required', 'Close');
                document.getElementById('customer_name').focus();
                return;
            }

            if (!phoneNo) {
                showCustomPopup('Error', 'Phone number is required', 'Close');
                document.getElementById('phone_no').focus();
                return;
            }

            if (!totalAmount || isNaN(parseFloat(totalAmount)) || parseFloat(totalAmount) <= 0) {
                showCustomPopup('Error', 'Please enter a valid total amount', 'Close');
                document.getElementById('total_amount').focus();
                return;
            }

            if (!date) {
                showCustomPopup('Error', 'Date is required', 'Close');
                document.getElementById('date').focus();
                return;
            }

            // Show loading state after validation passes
            addButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            addButton.disabled = true;

            // Get form data
            const form = document.getElementById('add-customer-form');
            const formData = new FormData(form);

            // Send AJAX request
            fetch('/customer/new', {
                method: 'POST',
                body: formData,
                redirect: 'manual' // Don't automatically follow redirects
            })
            .then(response => {
                // Reset button state
                addButton.innerHTML = originalButtonText;
                addButton.disabled = false;

                if (response.ok || response.type === 'opaqueredirect') {
                    // Show success message using custom popup
                    showCustomPopup('Success', 'Customer added successfully!', 'OK', function() {
                        // Reset the form
                        form.reset();
                        document.getElementById('date').value = new Date().toISOString().split('T')[0]; // Set today's date

                        // Refresh the page to show the new customer
                        window.location.href = '/customers?message=Customer+created+successfully';
                    });
                } else {
                    // Try to get error message from response
                    return response.text().then(text => {
                        try {
                            // Try to parse as JSON
                            const data = JSON.parse(text);
                            throw new Error(data.message || data.error || 'Error adding customer');
                        } catch (e) {
                            // If not JSON, use the text or a default message
                            throw new Error(text || 'Error adding customer. Please try again.');
                        }
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);

                // Reset button state
                addButton.innerHTML = originalButtonText;
                addButton.disabled = false;

                // Show error message
                showCustomPopup('Error', error.message || 'Error adding customer. Please try again.', 'Close');
            });
        }

        // Search button click handler
        document.getElementById('search-btn').addEventListener('click', function() {
            applyFilters();
        });

        // Apply filters button click handler - removed since we're using the inventory style

        // Handle Enter key in search input
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                applyFilters();
            }
        });

        // Status filter change handler
        document.getElementById('status-filter').addEventListener('change', function() {
            applyFilters();
        });

        // Function to apply filters
        function applyFilters() {
            const searchValue = document.getElementById('search-input').value;
            const statusFilter = document.getElementById('status-filter').value;
            window.location.href = `/customers?search=${encodeURIComponent(searchValue)}&status=${encodeURIComponent(statusFilter)}`;
        }
    });

    // This function is no longer needed as we're using form submission
    // for items per page change, keeping it for backward compatibility
    function changeItemsPerPage(value) {
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('limit', value);
        urlParams.set('page', 1); // Reset to first page when changing limit
        window.location.href = `/customers?${urlParams.toString()}`;
    }

    // Functions for delete modal
    function showDeleteModal(customerId, customerName) {
        // Set the customer name in the modal
        document.getElementById('delete-customer-name').textContent = customerName;

        // Set up the delete confirmation button
        document.getElementById('confirm-delete-btn').onclick = function() {
            deleteCustomer(customerId);
        };

        // Show the modal
        const modal = document.getElementById('delete-modal');
        modal.style.display = 'flex';
        modal.classList.remove('hidden');
    }

    function closeDeleteModal() {
        const modal = document.getElementById('delete-modal');
        modal.style.display = 'none';
        modal.classList.add('hidden');
    }

    function deleteCustomer(customerId) {
        // Show loading state
        const confirmBtn = document.getElementById('confirm-delete-btn');
        const originalText = confirmBtn.textContent;
        confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
        confirmBtn.disabled = true;

        // Send delete request to the API
        fetch(`/api/customers/${customerId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success message using custom popup
                showCustomPopup('Success', 'Customer deleted successfully', 'OK', function() {
                    // Reload the page to show updated list
                    window.location.reload();
                });
            } else {
                // Show error message
                showCustomPopup('Error', data.message || 'Failed to delete customer', 'Close');
                confirmBtn.textContent = originalText;
                confirmBtn.disabled = false;
                closeDeleteModal();
            }
        })
        .catch(error => {
            console.error('Error:', error);

            // Show error message
            showCustomPopup('Error', 'An error occurred while deleting the customer', 'Close');
            confirmBtn.textContent = originalText;
            confirmBtn.disabled = false;
            closeDeleteModal();
        });
    }

    // Function to export customers to Excel
    function exportCustomersToExcel() {
        // Show loading state
        const exportButton = document.getElementById('export-excel-btn');
        const originalButtonText = exportButton.innerHTML;
        exportButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
        exportButton.disabled = true;

        // Get current filters
        const searchValue = document.getElementById('search-input').value;
        const statusFilter = document.getElementById('status-filter').value;

        // Create a download link
        const downloadLink = document.createElement('a');
        downloadLink.href = `/api/customers/export-excel?search=${encodeURIComponent(searchValue)}&status=${encodeURIComponent(statusFilter)}`;
        downloadLink.target = '_blank';

        // Append to body, click, and remove
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        // Reset button state after a short delay
        setTimeout(() => {
            exportButton.innerHTML = originalButtonText;
            exportButton.disabled = false;
        }, 2000);
    }

    // Show a custom popup
    function showCustomPopup(title, message, buttonText, callback, cancelButtonText) {
        // Create popup elements
        const popup = document.createElement('div');
        popup.className = 'custom-popup';

        // Determine if we need a cancel button
        const cancelButton = cancelButtonText ?
            `<button class="popup-btn cancel">${cancelButtonText}</button>` : '';

        popup.innerHTML = `
            <div class="popup-content">
                <div class="popup-header">
                    <h3>${title}</h3>
                </div>
                <div class="popup-body">
                    <div class="popup-message">${message}</div>
                </div>
                <div class="popup-footer">
                    ${cancelButton}
                    <button class="popup-btn confirm">${buttonText}</button>
                </div>
            </div>
        `;

        // Add to body
        document.body.appendChild(popup);

        // Show popup with animation
        setTimeout(() => {
            popup.classList.add('show');
        }, 10);

        // Function to close the popup
        const closePopup = (runCallback) => {
            popup.classList.remove('show');

            setTimeout(() => {
                document.body.removeChild(popup);

                // Call callback if provided and requested
                if (runCallback && typeof callback === 'function') {
                    callback();
                }
            }, 300);
        };

        // Add event listener to confirm button
        const confirmButton = popup.querySelector('.popup-btn.confirm');
        confirmButton.addEventListener('click', function() {
            closePopup(true); // Close and run callback
        });

        // Add event listener to cancel button if it exists
        if (cancelButtonText) {
            const cancelBtn = popup.querySelector('.popup-btn.cancel');
            cancelBtn.addEventListener('click', function() {
                closePopup(false); // Close without running callback
            });
        }
    }

    function toggleEditMode(customerId) {
        const row = document.querySelector(`tr[data-customer-id="${customerId}"]`);
        
        // Toggle visibility of view/edit content
        row.querySelectorAll('.view-content').forEach(el => el.style.display = 'none');
        row.querySelectorAll('.edit-content').forEach(el => el.style.display = 'block');
        
        // Toggle visibility of action buttons
        row.querySelector('.action-btn.edit').style.display = 'none';
        row.querySelector('.action-btn.save').style.display = 'flex';
        row.querySelector('.action-btn.cancel').style.display = 'flex';
        
        // Auto-update payment status based on amounts
        const totalAmountInput = document.getElementById(`total-amount-${customerId}`);
        const amountPaidInput = document.getElementById(`amount-paid-${customerId}`);
        const statusSelect = document.getElementById(`payment-status-${customerId}`);
        
        function updatePaymentStatus() {
            const totalAmount = parseFloat(totalAmountInput.value) || 0;
            const amountPaid = parseFloat(amountPaidInput.value) || 0;
            
            if (amountPaid <= 0) {
                statusSelect.value = 'Unpaid';
            } else if (amountPaid >= totalAmount) {
                statusSelect.value = 'Fully Paid';
            } else {
                statusSelect.value = 'Partially Paid';
            }
        }
        
        totalAmountInput.addEventListener('input', updatePaymentStatus);
        amountPaidInput.addEventListener('input', updatePaymentStatus);
    }
    
    function cancelEdit(customerId) {
        const row = document.querySelector(`tr[data-customer-id="${customerId}"]`);
        
        // Restore view mode
        row.querySelectorAll('.view-content').forEach(el => el.style.display = 'block');
        row.querySelectorAll('.edit-content').forEach(el => el.style.display = 'none');
        
        // Restore action buttons
        row.querySelector('.action-btn.edit').style.display = 'flex';
        row.querySelector('.action-btn.save').style.display = 'none';
        row.querySelector('.action-btn.cancel').style.display = 'none';
    }
    
    function saveCustomerChanges(customerId) {
        const totalAmount = document.getElementById(`total-amount-${customerId}`).value;
        const amountPaid = document.getElementById(`amount-paid-${customerId}`).value;
        const paymentStatus = document.getElementById(`payment-status-${customerId}`).value;
        
        // Show loading state
        const saveBtn = document.querySelector(`tr[data-customer-id="${customerId}"] .action-btn.save`);
        const originalHTML = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        saveBtn.disabled = true;
        
        // Send update to server - use the correct URL format
        fetch(`/customers/${customerId}/update-payment`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                total_amount: parseFloat(totalAmount),
                amount_paid: parseFloat(amountPaid),
                payment_status: paymentStatus
            })
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(data => {
                    throw new Error(data.message || 'Error updating payment details');
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // Update the displayed values
                const row = document.querySelector(`tr[data-customer-id="${customerId}"]`);
                row.querySelector('td:nth-child(5) .view-content').textContent = `₹${totalAmount}`;
                row.querySelector('td:nth-child(6) .view-content').textContent = `₹${amountPaid}`;
                
                const statusBadge = row.querySelector('td:nth-child(7) .view-content');
                statusBadge.textContent = paymentStatus;
                statusBadge.className = `view-content status-badge ${
                    paymentStatus === 'Fully Paid' ? 'status-paid' : 
                    paymentStatus === 'Partially Paid' ? 'status-partial' : 
                    'status-unpaid'
                }`;
                
                // Exit edit mode
                cancelEdit(customerId);
                
                // Show success notification
                showNotification('Payment details updated successfully', 'success');
            } else {
                showNotification('Error updating payment details', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification(error.message || 'Error updating payment details', 'error');
        })
        .finally(() => {
            // Restore button state
            saveBtn.innerHTML = originalHTML;
            saveBtn.disabled = false;
        });
    }
    
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);
        
        // Show notification
        setTimeout(() => notification.classList.add('show'), 10);
        
        // Hide and remove after 3 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Add these functions for PDF viewing and downloading
    
</script>
{% endblock %}

<style>
    .edit-input {
        width: 100%;
        padding: 5px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--input-bg);
        color: var(--input-text);
    }
    
    .action-btn.edit {
        background-color: var(--accent-tertiary);
    }
    
    .action-btn.save {
        background-color: var(--success-color);
    }
    
    .action-btn.cancel {
        background-color: var(--text-secondary);
    }
    
    /* Notification styles */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        gap: 10px;
        transform: translateY(-20px);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1000;
    }
    
    .notification.show {
        transform: translateY(0);
        opacity: 1;
    }
    
    .notification.success {
        border-left: 4px solid #28a745;
    }
    
    .notification.error {
        border-left: 4px solid #dc3545;
    }
    
    .notification i {
        font-size: 18px;
    }
    
    .notification.success i {
        color: #28a745;
    }
    
    .notification.error i {
        color: #dc3545;
    }
    
    /* Add styles for PDF and download buttons */
    .action-btn.pdf {
        background-color: var(--info-color, #17a2b8);
    }
    
    .action-btn.download {
        background-color: var(--success-color, #28a745);
    }
    
    /* Ensure all action buttons have consistent styling */
    .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        margin: 0 2px;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .action-btn-group {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 5px;
    }
</style>




