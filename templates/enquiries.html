{% extends "base.html" %}

{% block title %}Enquiries | Sunmax Renewables{% endblock %}

{% block head %}
<style>
    /* Notification styles */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        transform: translateX(420px);
        transition: transform 0.3s ease-in-out;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification-content {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        background-color: white;
        margin-bottom: 10px;
    }

    .notification-icon {
        margin-right: 12px;
        font-size: 20px;
    }

    .notification-success .notification-icon {
        color: #4CAF50;
    }

    .notification-error .notification-icon {
        color: #F44336;
    }

    .notification-info .notification-icon {
        color: #2196F3;
    }

    .notification-message {
        flex: 1;
        font-size: 14px;
    }

    .notification-close {
        margin-left: 12px;
        cursor: pointer;
        font-size: 18px;
        color: #999;
    }

    .notification-close:hover {
        color: #333;
    }
</style>
{% endblock %}

{% block content %}
<div class="enquiry-container">
    <div class="page-header">
        <h2>Customer Enquiries</h2>
        <p>Manage customer enquiries and track potential business opportunities</p>
    </div>

    <!-- Enquiry Form Section -->
    <div class="enquiry-form-container">
        <div class="form-header">
            <h3>Add New Customer</h3>
            <p>Enter customer details and requirements to create a new enquiry</p>
        </div>

        <form id="add-enquiry-form" method="POST" action="/enquiry/new">
            <div class="form-row">
                <div class="form-group">
                    <label for="date">Date:</label>
                    <input type="date" id="date" name="date" required value="{{ today }}">
                </div>

                <div class="form-group">
                    <label for="customer_name">Customer Name:</label>
                    <input type="text" id="customer_name" name="customer_name" required placeholder="Enter customer name">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="phone_no">Phone Number:</label>
                    <input type="text" id="phone_no" name="phone_no" required placeholder="Enter phone number">
                </div>

                <div class="form-group">
                    <label for="address">Address:</label>
                    <input type="text" id="address" name="address" placeholder="Enter customer address">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group full-width">
                    <label for="requirements">Requirements:</label>
                    <textarea id="requirements" name="requirements" rows="3" placeholder="Enter customer requirements"></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="quotation_given" name="quotation_given" onchange="toggleQuotationAmount()">
                    <label for="quotation_given">Quotation Given</label>
                </div>

                <div class="form-group" id="quotation_amount_group" style="display: none;">
                    <label for="quotation_amount">Quotation Amount (₹):</label>
                    <input type="number" id="quotation_amount" name="quotation_amount" step="0.01" min="0" value="0" placeholder="Enter amount">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" id="add-enquiry-btn" class="submit-btn">
                    <i class="fas fa-plus"></i> ADD CUSTOMER
                </button>
            </div>
        </form>

        {% if message %}
        <div id="server-success-message" class="success-message">
            <i class="success-icon">✓</i>
            <p>{{ message }}</p>
            <span class="close-message" onclick="this.parentElement.remove()">&times;</span>
        </div>
        <script>
            // Auto-dismiss the server-side success message after 5 seconds
            setTimeout(() => {
                const serverMessage = document.getElementById('server-success-message');
                if (serverMessage) {
                    serverMessage.remove();
                }
            }, 5000);
        </script>
        {% endif %}
    </div>

    <!-- Enquiry List Section -->
    <div class="current-enquiries">
        <div class="enquiry-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3>Current Enquiries</h3>
            <div style="display: flex; gap: 15px;">
                <button id="import-excel-btn" class="btn btn-success" onclick="showImportModal()">
                    <i class="fas fa-file-import"></i> Import from Excel
                </button>
                <button id="export-excel-btn" class="btn btn-primary" onclick="exportToExcel()">
                    <i class="fas fa-file-export"></i> Export to Excel
                </button>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search by enquiry number or customer name">
                    <button class="search-button" onclick="applyFilters()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <div class="filter-group">
                    <select id="date-filter" class="filter-select" onchange="applyFilters()">
                        <option value="all">All Dates</option>
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="this_week">This Week</option>
                        <option value="last_week">Last Week</option>
                        <option value="this_month">This Month</option>
                        <option value="last_month">Last Month</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>

                <div class="filter-group">
                    <select id="quotation-filter" class="filter-select" onchange="applyFilters()">
                        <option value="all">All Quotation Status</option>
                        <option value="yes">Quotation Given</option>
                        <option value="no">No Quotation</option>
                    </select>
                </div>

                <button id="reset-filters-btn" class="reset-filters-btn" onclick="resetFilters()">
                    <i class="fas fa-undo"></i> Reset Filters
                </button>
            </div>

            <!-- Custom Date Range (hidden by default) -->
            <div id="custom-date-range" class="custom-date-range" style="display: none;">
                <div class="date-inputs">
                    <div class="date-input-group">
                        <label for="start-date">From:</label>
                        <input type="date" id="start-date" class="date-input">
                    </div>
                    <div class="date-input-group">
                        <label for="end-date">To:</label>
                        <input type="date" id="end-date" class="date-input">
                    </div>
                    <button class="apply-date-btn" onclick="applyCustomDateRange()">Apply</button>
                </div>
            </div>
        </div>

        <!-- Enquiry Search and Edit Panel -->
        <div id="enquiry-search-panel" class="search-panel" style="display: none;">
            <div class="search-container">
                <input type="text" id="enquiry-search-input" placeholder="Search by Enquiry Number or Customer Name...">
                <button class="btn primary" onclick="searchEnquiry()">
                    <i class="fas fa-search"></i> Search
                </button>
                <button class="btn secondary" onclick="toggleEditSearch()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            <div id="search-results" class="search-results">
                <!-- Search results will appear here -->
            </div>
        </div>

        {% if enquiries %}
        <div class="inventory-info">
            <div class="inventory-count">
                Showing {{ enquiries|length }} enquiries
            </div>
        </div>

        <div class="enquiry-table-container">
            <table class="inventory-table enquiry-table">
                <thead>
                    <tr class="table-header">
                        <th>Enquiry No.</th>
                        <th>Date</th>
                        <th>Customer Name</th>
                        <th>Phone Number</th>
                        <th>Requirements</th>
                        <th>Quotation Given</th>
                        <th>Amount (₹)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for enquiry in enquiries %}
                    <tr id="row-{{ enquiry.id }}" data-enquiry-id="{{ enquiry.id }}">
                        <td>{{ enquiry.enquiry_number }}</td>
                        <td>
                            <span class="view-content">{{ enquiry.date.strftime('%d-%m-%Y') if enquiry.date.strftime else enquiry.date }}</span>
                            <div class="edit-content" style="display: none;">
                                <input type="date" class="edit-input" id="date-{{ enquiry.id }}" value="{{ enquiry.date.strftime('%Y-%m-%d') if enquiry.date.strftime else enquiry.date }}">
                            </div>
                        </td>
                        <td>
                            <span class="view-content">{{ enquiry.customer_name }}</span>
                            <div class="edit-content" style="display: none;">
                                <input type="text" class="edit-input" id="customer-name-{{ enquiry.id }}" value="{{ enquiry.customer_name }}">
                            </div>
                        </td>
                        <td>
                            <span class="view-content">{{ enquiry.phone_no }}</span>
                            <div class="edit-content" style="display: none;">
                                <input type="text" class="edit-input" id="phone-{{ enquiry.id }}" value="{{ enquiry.phone_no }}">
                            </div>
                        </td>
                        <td class="requirements-cell" title="{{ enquiry.requirements }}">
                            <span class="view-content">{{ enquiry.requirements }}</span>
                            <div class="edit-content" style="display: none;">
                                <textarea class="edit-input" id="requirements-{{ enquiry.id }}" rows="2">{{ enquiry.requirements }}</textarea>
                            </div>
                        </td>
                        <td>
                            <span class="view-content">
                                <span class="status-badge {% if enquiry.quotation_given %}status-success{% else %}status-pending{% endif %}">
                                    {{ "Yes" if enquiry.quotation_given else "No" }}
                                </span>
                            </span>
                            <div class="edit-content" style="display: none;">
                                <select class="edit-input" id="quotation-given-{{ enquiry.id }}">
                                    <option value="true" {% if enquiry.quotation_given %}selected{% endif %}>Yes</option>
                                    <option value="false" {% if not enquiry.quotation_given %}selected{% endif %}>No</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            <span class="view-content">{{ "₹" + "%.2f"|format(enquiry.quotation_amount) if enquiry.quotation_given and enquiry.quotation_amount else "-" }}</span>
                            <div class="edit-content" style="display: none;">
                                <input type="number" class="edit-input" id="quotation-amount-{{ enquiry.id }}" value="{{ enquiry.quotation_amount if enquiry.quotation_amount else '' }}" step="0.01" min="0">
                            </div>
                        </td>
                        <td class="enquiry-actions">
                            <div class="view-content action-buttons">
                                <button class="edit-btn" onclick="editEnquiry('{{ enquiry.id }}')" title="Edit Enquiry">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-btn" onclick="confirmDeleteEnquiry('{{ enquiry.id }}', '{{ enquiry.customer_name }}')" title="Delete Enquiry">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="edit-content" style="display: none;">
                                <button class="save-btn" onclick="saveEnquiryChanges('{{ enquiry.id }}')" title="Save Changes">
                                    <i class="fas fa-save"></i>
                                </button>
                                <button class="cancel-btn" onclick="cancelEdit()" title="Cancel">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Pagination controls -->
            <div class="pagination-controls">
                {% if total_pages > 1 %}
                    <div class="pagination">
                        {% if current_page > 1 %}
                            <a href="/enquiries?page=1&limit={{ limit }}" class="pagination-btn">First</a>
                            <a href="/enquiries?page={{ current_page - 1 }}&limit={{ limit }}" class="pagination-btn">Previous</a>
                        {% else %}
                            <span class="pagination-btn disabled">First</span>
                            <span class="pagination-btn disabled">Previous</span>
                        {% endif %}

                        <span class="pagination-info">Page {{ current_page }} of {{ total_pages }}</span>

                        {% if current_page < total_pages %}
                            <a href="/enquiries?page={{ current_page + 1 }}&limit={{ limit }}" class="pagination-btn">Next</a>
                            <a href="/enquiries?page={{ total_pages }}&limit={{ limit }}" class="pagination-btn">Last</a>
                        {% else %}
                            <span class="pagination-btn disabled">Next</span>
                            <span class="pagination-btn disabled">Last</span>
                        {% endif %}
                    </div>

                    <div class="pagination-options">
                        <form action="/enquiries" method="get" class="items-per-page-form">
                            <label for="limit">Items per page:</label>
                            <select name="limit" id="limit" onchange="this.form.submit()">
                                <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                                <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
                                <option value="200" {% if limit == 200 %}selected{% endif %}>200</option>
                                <option value="500" {% if limit == 500 %}selected{% endif %}>500</option>
                            </select>
                            <input type="hidden" name="page" value="1">
                            <!-- Preserve any active filters -->
                            <script>
                                // Add current filter values to the form when changing items per page
                                document.addEventListener('DOMContentLoaded', function() {
                                    const form = document.querySelector('.items-per-page-form');
                                    const searchInput = document.getElementById('search-input');
                                    const dateFilter = document.getElementById('date-filter');
                                    const quotationFilter = document.getElementById('quotation-filter');

                                    if (form && searchInput && dateFilter && quotationFilter) {
                                        form.addEventListener('submit', function() {
                                            // Add search term if present
                                            if (searchInput.value) {
                                                const searchField = document.createElement('input');
                                                searchField.type = 'hidden';
                                                searchField.name = 'customer_name';
                                                searchField.value = searchInput.value;
                                                form.appendChild(searchField);
                                            }

                                            // Add date filter if not 'all'
                                            if (dateFilter.value !== 'all') {
                                                const dateField = document.createElement('input');
                                                dateField.type = 'hidden';
                                                dateField.name = 'date_filter';
                                                dateField.value = dateFilter.value;
                                                form.appendChild(dateField);

                                                // Add custom date range if applicable
                                                if (dateFilter.value === 'custom') {
                                                    const startDate = document.getElementById('start-date');
                                                    const endDate = document.getElementById('end-date');

                                                    if (startDate && startDate.value) {
                                                        const startField = document.createElement('input');
                                                        startField.type = 'hidden';
                                                        startField.name = 'date_from';
                                                        startField.value = startDate.value;
                                                        form.appendChild(startField);
                                                    }

                                                    if (endDate && endDate.value) {
                                                        const endField = document.createElement('input');
                                                        endField.type = 'hidden';
                                                        endField.name = 'date_to';
                                                        endField.value = endDate.value;
                                                        form.appendChild(endField);
                                                    }
                                                }
                                            }

                                            // Add quotation filter if not 'all'
                                            if (quotationFilter.value !== 'all') {
                                                const quotationField = document.createElement('input');
                                                quotationField.type = 'hidden';
                                                quotationField.name = 'quotation_given';
                                                quotationField.value = quotationFilter.value === 'yes' ? 'true' : 'false';
                                                form.appendChild(quotationField);
                                            }
                                        });
                                    }
                                });
                            </script>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="no-data-message">
            <div class="no-data-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <h3>No Enquiries Found</h3>
            <p>You haven't added any customer enquiries yet. Use the form above to create your first enquiry.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <span class="close" onclick="closeDeleteModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete the enquiry from <span id="delete-customer-name"></span>?</p>
            <p class="warning-text">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
            <button class="delete-confirm-btn" onclick="deleteEnquiry()">Delete</button>
        </div>
    </div>
</div>

<!-- Import Excel Modal -->
<div id="import-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="background-color: var(--primary-color); color: white;">
            <h3>Import Enquiries from Excel</h3>
            <span class="close" onclick="closeImportModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p style="margin-top: 0; margin-bottom: 6px; font-size: 13px;">Upload an Excel file with the following columns:</p>
            <ul class="required-columns">
                <li>customer_name</li>
                <li>phone_no</li>
                <li>address</li>
                <li>requirements</li>
                <li>quotation_given</li>
                <li>quotation_amount</li>
                <li>date</li>
            </ul>
            <div class="import-instructions">
                <p><strong>IMPORTANT:</strong> The system will generate unique enquiry numbers automatically.</p>
                <p><strong>Note:</strong> All columns are required except address and requirements.</p>
            </div>
            <div class="template-info">
                <p style="margin: 0;">Need a template? <a href="#" onclick="downloadTemplate(); return false;">Download template file</a></p>
            </div>

            <div class="file-upload-container">
                <input type="file" id="excel-file" accept=".xlsx, .xls, .csv" />
                <div class="file-upload-info" id="file-upload-info">No file selected</div>
                <div class="file-types">Accepted formats: .xlsx, .xls, .csv</div>
            </div>
            <div id="import-message" class="import-message hidden"></div>
        </div>
        <div class="modal-footer">
            <button class="cancel-btn" onclick="closeImportModal()">Cancel</button>
            <button class="btn btn-success" id="upload-excel-btn" onclick="uploadExcelFile()">
                <i class="fas fa-upload"></i> Import
            </button>
        </div>
    </div>
</div>

<!-- Template Download Modal -->
<div id="template-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Download Template</h3>
            <span class="close" onclick="closeTemplateModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Download a template Excel file with the required columns:</p>
            <button class="download-template-btn" onclick="downloadTemplate()">
                <i class="fas fa-download"></i> Download Template
            </button>
        </div>
    </div>
</div>

<script>
    // Variables to track current enquiry for deletion and edit mode
    let currentEnquiryId = null;
    let currentCustomerName = null;
    let isEditMode = false;

    // Function to toggle the quotation amount field based on checkbox
    function toggleQuotationAmount() {
        const quotationGiven = document.getElementById('quotation_given').checked;
        const quotationAmountGroup = document.getElementById('quotation_amount_group');
        const quotationAmountInput = document.getElementById('quotation_amount');

        if (quotationGiven) {
            quotationAmountGroup.style.display = 'block';
            // If the value is 0 or empty, set it to a default value
            if (!quotationAmountInput.value || quotationAmountInput.value === '0') {
                quotationAmountInput.value = '0';
            }
        } else {
            quotationAmountGroup.style.display = 'none';
            // Set to 0 instead of empty string to avoid parsing issues
            quotationAmountInput.value = '0';
        }
    }

    // Function to add a new enquiry to database using AJAX
    function addEnquiryToDatabase() {
        // Show loading state
        const addButton = document.getElementById('add-enquiry-btn');
        const originalButtonText = addButton.innerHTML;
        addButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        addButton.disabled = true;

        // Get form data
        const form = document.getElementById('add-enquiry-form');
        const formData = new FormData(form);

        // Ensure quotation_amount is properly set based on quotation_given
        const quotationGiven = formData.get('quotation_given') === 'on';
        if (!quotationGiven) {
            formData.set('quotation_amount', '0');
        }

        // Send AJAX request
        fetch('/enquiry/new', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            // If the response is a redirect, follow it
            if (response.redirected) {
                window.location.href = response.url;
                return { success: true };
            }

            // Try to parse as JSON, but handle non-JSON responses
            try {
                return response.json();
            } catch (e) {
                return { success: response.ok };
            }
        })
        .then(data => {
            // Reset button state
            addButton.innerHTML = originalButtonText;
            addButton.disabled = false;

            if (data && data.success) {
                // Show success message
                showSuccessMessage(data.message || 'Enquiry added successfully');

                // Reset the form
                form.reset();
                document.getElementById('date').value = new Date().toISOString().split('T')[0]; // Set today's date

                // Refresh the page to show the new enquiry
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                // Show error message
                showErrorMessage(data?.message || 'Error adding enquiry. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);

            // Reset button state
            addButton.innerHTML = originalButtonText;
            addButton.disabled = false;

            // Show error message
            showErrorMessage('Error adding enquiry. Please try again.');
        });
    }

    // Function to handle date filter change
    function handleDateFilterChange() {
        const dateFilter = document.getElementById('date-filter');
        const customDateRange = document.getElementById('custom-date-range');

        if (dateFilter.value === 'custom') {
            customDateRange.style.display = 'block';
            // Set default dates if empty
            if (!document.getElementById('start-date').value) {
                const today = new Date();
                const lastMonth = new Date();
                lastMonth.setMonth(lastMonth.getMonth() - 1);

                document.getElementById('start-date').value = formatDate(lastMonth);
                document.getElementById('end-date').value = formatDate(today);
            }
        } else {
            customDateRange.style.display = 'none';
            applyFilters();
        }
    }

    // Function to format date as YYYY-MM-DD
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Function to apply custom date range
    function applyCustomDateRange() {
        applyFilters();
    }

    // Function to reset all filters
    function resetFilters() {
        document.getElementById('search-input').value = '';
        document.getElementById('date-filter').value = 'all';
        document.getElementById('quotation-filter').value = 'all';
        document.getElementById('custom-date-range').style.display = 'none';

        // Show all rows
        const rows = document.querySelectorAll('.enquiry-table tbody tr');
        rows.forEach(row => {
            row.style.display = '';
        });

        // Update the count
        updateFilteredCount();
    }

    // Function to apply all filters
    function applyFilters() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        const dateFilter = document.getElementById('date-filter').value;
        const quotationFilter = document.getElementById('quotation-filter').value;

        const rows = document.querySelectorAll('.enquiry-table tbody tr');

        rows.forEach(row => {
            // Get row data
            const text = row.textContent.toLowerCase();
            const dateCell = row.cells[1].querySelector('.view-content').textContent;
            const date = parseDate(dateCell);
            const quotationCell = row.cells[5].querySelector('.view-content').textContent;
            const hasQuotation = quotationCell.includes('Yes');

            // Apply search filter
            const matchesSearch = !searchTerm || text.includes(searchTerm);

            // Apply date filter
            const matchesDate = dateFilter === 'all' || matchesDateFilter(date, dateFilter);

            // Apply quotation filter
            const matchesQuotation = quotationFilter === 'all' ||
                                    (quotationFilter === 'yes' && hasQuotation) ||
                                    (quotationFilter === 'no' && !hasQuotation);

            // Show/hide row based on all filters
            if (matchesSearch && matchesDate && matchesQuotation) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });

        // Update the count
        updateFilteredCount();
    }

    // Function to parse date from DD-MM-YYYY format
    function parseDate(dateStr) {
        const parts = dateStr.split('-');
        // Convert to YYYY-MM-DD format for Date constructor
        return new Date(parts[2], parts[1] - 1, parts[0]);
    }

    // Function to check if a date matches the selected filter
    function matchesDateFilter(date, filter) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);

        // Start of this week (Sunday)
        const thisWeekStart = new Date(today);
        thisWeekStart.setDate(today.getDate() - today.getDay());

        // Start of last week
        const lastWeekStart = new Date(thisWeekStart);
        lastWeekStart.setDate(lastWeekStart.getDate() - 7);

        // End of last week
        const lastWeekEnd = new Date(thisWeekStart);
        lastWeekEnd.setDate(lastWeekEnd.getDate() - 1);

        // Start of this month
        const thisMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);

        // Start of last month
        const lastMonthStart = new Date(today.getFullYear(), today.getMonth() - 1, 1);

        // End of last month
        const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);

        // Custom date range
        if (filter === 'custom') {
            const startDate = new Date(document.getElementById('start-date').value);
            const endDate = new Date(document.getElementById('end-date').value);
            endDate.setHours(23, 59, 59, 999); // Include the entire end day

            return date >= startDate && date <= endDate;
        }

        // Reset hours to compare dates properly
        date.setHours(0, 0, 0, 0);

        switch (filter) {
            case 'today':
                return date.getTime() === today.getTime();
            case 'yesterday':
                return date.getTime() === yesterday.getTime();
            case 'this_week':
                return date >= thisWeekStart && date <= today;
            case 'last_week':
                return date >= lastWeekStart && date <= lastWeekEnd;
            case 'this_month':
                return date >= thisMonthStart && date <= today;
            case 'last_month':
                return date >= lastMonthStart && date <= lastMonthEnd;
            default:
                return true;
        }
    }

    // Function to update the filtered count
    function updateFilteredCount() {
        const visibleRows = document.querySelectorAll('.enquiry-table tbody tr:not([style*="display: none"])');
        const countElement = document.querySelector('.inventory-count');
        if (countElement) {
            countElement.textContent = `Showing ${visibleRows.length} enquiries`;
        }
    }

    // Function to search enquiries (simple version for backward compatibility)
    function searchEnquiries() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        const rows = document.querySelectorAll('.enquiry-table tbody tr');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });

        // Update the count
        updateFilteredCount();
    }

    // Function to toggle edit search panel
    function toggleEditSearch() {
        const searchPanel = document.getElementById('enquiry-search-panel');
        if (searchPanel.style.display === 'none' || !searchPanel.style.display) {
            searchPanel.style.display = 'block';
            document.getElementById('enquiry-search-input').focus();
        } else {
            searchPanel.style.display = 'none';
        }
    }

    // Function to search for an enquiry to edit
    function searchEnquiry() {
        const searchTerm = document.getElementById('enquiry-search-input').value.toLowerCase();
        if (!searchTerm) {
            showErrorMessage('Please enter a search term');
            return;
        }

        // Show loading state
        const searchResults = document.getElementById('search-results');
        searchResults.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';

        // Get all enquiries from the table
        const rows = document.querySelectorAll('.enquiry-table tbody tr');
        const results = [];

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                const enquiryId = row.getAttribute('data-enquiry-id');
                const enquiryNumber = row.cells[0].textContent;
                const customerName = row.cells[2].querySelector('.view-content').textContent;

                results.push({
                    id: enquiryId,
                    number: enquiryNumber,
                    name: customerName
                });
            }
        });

        // Display results
        if (results.length > 0) {
            let resultsHtml = '<ul class="search-results-list">';
            results.forEach(result => {
                resultsHtml += `
                    <li>
                        <div class="search-result-item">
                            <div class="search-result-info">
                                <span class="search-result-number">${result.number}</span>
                                <span class="search-result-name">${result.name}</span>
                            </div>
                            <button class="edit-btn" onclick="toggleEditMode('${result.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    </li>
                `;
            });
            resultsHtml += '</ul>';
            searchResults.innerHTML = resultsHtml;
        } else {
            searchResults.innerHTML = '<div class="no-results">No enquiries found matching your search</div>';
        }
    }

    // Function to edit a specific enquiry
    function editEnquiry(enquiryId) {
        // Set the current enquiry ID
        currentEnquiryId = enquiryId;
        isEditMode = true;

        // Enable edit mode for the specific row
        const row = document.querySelector(`tr[data-enquiry-id="${enquiryId}"]`);
        if (row) {
            const viewContents = row.querySelectorAll('.view-content');
            const editContents = row.querySelectorAll('.edit-content');

            viewContents.forEach(el => el.style.display = 'none');
            editContents.forEach(el => el.style.display = 'block');

            // Handle quotation amount visibility based on quotation given
            const quotationGivenSelect = document.getElementById(`quotation-given-${enquiryId}`);
            const quotationAmountInput = document.getElementById(`quotation-amount-${enquiryId}`);

            if (quotationGivenSelect && quotationAmountInput) {
                // Add change event listener to handle quotation amount visibility
                quotationGivenSelect.addEventListener('change', function() {
                    const isQuotationGiven = this.value === 'true';

                    if (!isQuotationGiven) {
                        // If quotation is not given, clear the amount
                        quotationAmountInput.value = '0';
                    }
                });
            }
        }
    }

    // Function to toggle edit mode for all rows or a specific row
    function toggleEditMode(enquiryId = null) {
        isEditMode = !isEditMode;

        const editButton = document.getElementById('edit-enquiry-btn');
        const rows = document.querySelectorAll('.enquiry-table tbody tr');

        if (isEditMode) {
            editButton.innerHTML = '<i class="fas fa-times"></i> Cancel Edit';
            editButton.classList.add('cancel-edit');

            // If enquiryId is provided, only enable edit mode for that row
            // and set it as the current enquiry ID
            if (enquiryId) {
                currentEnquiryId = enquiryId;
            }

            rows.forEach(row => {
                const rowId = row.getAttribute('data-enquiry-id');
                if (!enquiryId || rowId === enquiryId) {
                    const viewContents = row.querySelectorAll('.view-content');
                    const editContents = row.querySelectorAll('.edit-content');

                    viewContents.forEach(el => el.style.display = 'none');
                    editContents.forEach(el => el.style.display = 'block');

                    // Handle quotation amount visibility based on quotation given
                    if (rowId) {
                        const quotationGivenSelect = document.getElementById(`quotation-given-${rowId}`);
                        const quotationAmountInput = document.getElementById(`quotation-amount-${rowId}`);

                        if (quotationGivenSelect && quotationAmountInput) {
                            // Set initial visibility
                            const isQuotationGiven = quotationGivenSelect.value === 'true';
                            if (!isQuotationGiven) {
                                quotationAmountInput.value = '0';
                            }

                            // Add change event listener
                            quotationGivenSelect.addEventListener('change', function() {
                                const isQuotationGiven = this.value === 'true';
                                if (!isQuotationGiven) {
                                    quotationAmountInput.value = '0';
                                }
                            });
                        }
                    }
                }
            });

            // Close the search panel if it's open
            const searchPanel = document.getElementById('enquiry-search-panel');
            if (searchPanel) {
                searchPanel.style.display = 'none';
            }
        } else {
            editButton.innerHTML = '<i class="fas fa-edit"></i> Edit Enquiry';
            editButton.classList.remove('cancel-edit');

            // Reset current enquiry ID when exiting edit mode
            currentEnquiryId = null;

            // Disable edit mode for all rows
            rows.forEach(row => {
                const viewContents = row.querySelectorAll('.view-content');
                const editContents = row.querySelectorAll('.edit-content');

                viewContents.forEach(el => el.style.display = '');
                editContents.forEach(el => el.style.display = 'none');
            });
        }
    }

    // Function to cancel edit mode
    function cancelEdit() {
        toggleEditMode();
    }

    // Function to save changes to an enquiry
    function saveEnquiryChanges(enquiryId) {
        // Get all the edited values
        const date = document.getElementById(`date-${enquiryId}`).value;
        const customerName = document.getElementById(`customer-name-${enquiryId}`).value;
        const phoneNo = document.getElementById(`phone-${enquiryId}`).value;
        const requirements = document.getElementById(`requirements-${enquiryId}`).value || '';
        const quotationGiven = document.getElementById(`quotation-given-${enquiryId}`).value === 'true';
        const quotationAmount = document.getElementById(`quotation-amount-${enquiryId}`).value || '0';

        // Validate required fields
        if (!customerName || !phoneNo || !date) {
            showErrorMessage('Customer name, phone number, and date are required');
            return;
        }

        // Validate quotation amount if quotation is given
        if (quotationGiven && (isNaN(parseFloat(quotationAmount)) || parseFloat(quotationAmount) <= 0)) {
            showErrorMessage('Please enter a valid quotation amount greater than zero');
            return;
        }

        // Create data object
        const data = {
            customer_name: customerName,
            phone_no: phoneNo,
            address: '', // Adding empty address field since it's expected by the backend
            requirements: requirements,
            quotation_given: quotationGiven,
            quotation_amount: quotationGiven ? quotationAmount : '0',
            date: date
        };

        // Show loading state
        const saveButton = document.querySelector(`#row-${enquiryId} .save-btn`);
        const originalButtonHTML = saveButton.innerHTML;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        saveButton.disabled = true;

        // Send AJAX request
        fetch(`/enquiry/${enquiryId}/edit`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(data)
        })
        .then(response => {
            // If the response is a redirect, follow it
            if (response.redirected) {
                // Show success message before redirecting
                showSuccessMessage('Enquiry updated successfully');

                // Redirect after a short delay
                setTimeout(() => {
                    window.location.href = response.url;
                }, 1000);
                return { success: true };
            }

            // If response is not ok (status code not in 200-299 range)
            if (!response.ok) {
                if (response.status === 422) {
                    throw new Error('Validation error: Please check all required fields');
                }
                throw new Error(`Server error: ${response.status}`);
            }

            // Try to parse as JSON, but handle non-JSON responses
            try {
                return response.json();
            } catch (e) {
                return { success: true };
            }
        })
        .then(data => {
            // Reset button state
            saveButton.innerHTML = originalButtonHTML;
            saveButton.disabled = false;

            if (data && data.success) {
                // Show success message
                showSuccessMessage('Enquiry updated successfully');

                // Exit edit mode
                toggleEditMode();

                // Refresh the page to show the updated enquiry
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                // Show error message
                showErrorMessage(data?.message || 'Error updating enquiry');
            }
        })
        .catch(error => {
            console.error('Error:', error);

            // Reset button state
            saveButton.innerHTML = originalButtonHTML;
            saveButton.disabled = false;

            // Show error message
            showErrorMessage('Error updating enquiry: ' + error.message);
        });
    }

    // Function to show success message
    function showSuccessMessage(message) {
        showNotification(message, 'success');
    }

    // Function to show error message
    function showErrorMessage(message) {
        showNotification(message, 'error');
    }

    // Function to show notification
    function showNotification(message, type = 'info') {
        // Create notification element if it doesn't exist
        let notification = document.getElementById('notification');
        if (!notification) {
            notification = document.createElement('div');
            notification.id = 'notification';
            notification.className = 'notification';
            document.body.appendChild(notification);
        }

        // Set notification type class
        notification.className = 'notification';
        notification.classList.add(`notification-${type}`);

        // Set content
        notification.innerHTML = `
            <div class="notification-content">
                <i class="notification-icon ${type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'}"></i>
                <span class="notification-message">${message}</span>
                <span class="notification-close" onclick="this.parentElement.parentElement.classList.remove('show')">&times;</span>
            </div>
        `;

        // Show notification
        notification.classList.add('show');

        // Auto-hide after 5 seconds
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }

    // Function to show delete confirmation modal
    function showDeleteModal(enquiryId, customerName) {
        currentEnquiryId = enquiryId;
        currentCustomerName = customerName;

        // Update modal content
        document.getElementById('delete-customer-name').textContent = customerName;

        // Show modal
        document.getElementById('delete-modal').classList.remove('hidden');
    }

    // Function to close delete modal
    function closeDeleteModal() {
        document.getElementById('delete-modal').classList.add('hidden');
        // Reset current enquiry
        currentEnquiryId = null;
        currentCustomerName = null;
    }

    // Function to confirm deletion with a simple confirm dialog
    function confirmDeleteEnquiry(enquiryId, customerName) {
        if (confirm(`Are you sure you want to delete the enquiry from ${customerName}? This action cannot be undone.`)) {
            // Show a loading message
            showSuccessMessage('Deleting enquiry...');

            // Redirect to the delete endpoint
            window.location.href = `/enquiry/${enquiryId}/delete`;
        }
    }

    // Function to delete an enquiry (using the modal)
    function deleteEnquiry() {
        if (!currentEnquiryId) {
            showErrorMessage('No enquiry selected for deletion');
            return;
        }

        // Show loading state in the delete button
        const deleteButton = document.querySelector('.delete-confirm-btn');
        const originalButtonText = deleteButton.innerHTML;
        deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
        deleteButton.disabled = true;

        // Store the ID locally in case it gets reset
        const enquiryIdToDelete = currentEnquiryId;

        // Close the modal
        closeDeleteModal();

        // Show a loading message
        showSuccessMessage('Deleting enquiry...');

        // Redirect to the delete endpoint
        window.location.href = `/enquiry/${enquiryIdToDelete}/delete`;
    }

    // Function to show import modal
    function showImportModal() {
        const modal = document.getElementById('import-modal');
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
    }

    // Function to close import modal
    function closeImportModal() {
        const modal = document.getElementById('import-modal');
        modal.classList.add('hidden');
        modal.style.display = 'none';
    }

    // Function to show template modal
    function closeTemplateModal() {
        document.getElementById('template-modal').classList.add('hidden');
    }

    // Function to download template
    function downloadTemplate() {
        // Create a download link
        const downloadLink = document.createElement('a');
        downloadLink.href = '/api/enquiries/download-template';
        downloadLink.target = '_blank';

        // Append to body, click, and remove
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        // Close the template modal if it's open
        closeTemplateModal();
    }

    // Function to upload Excel file
    function uploadExcelFile() {
        const fileInput = document.getElementById('excel-file');
        const file = fileInput.files[0];

        if (!file) {
            showImportMessage('Please select a file to upload', 'error');
            return;
        }

        // Show loading state
        const uploadButton = document.getElementById('upload-excel-btn');
        const originalButtonText = uploadButton.innerHTML;
        uploadButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Importing...';
        uploadButton.disabled = true;

        // Create form data
        const formData = new FormData();
        formData.append('file', file);

        // Send AJAX request
        fetch('/api/enquiries/import-excel', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Reset button state
            uploadButton.innerHTML = originalButtonText;
            uploadButton.disabled = false;

            if (data.success) {
                // Show success message
                showImportMessage(`Successfully imported ${data.count} enquiries`, 'success');

                // Clear the file input
                fileInput.value = '';
                document.getElementById('file-upload-info').textContent = 'No file selected';

                // Refresh the page after a delay
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } else {
                // Show error message
                showImportMessage(data.message || 'Error importing enquiries', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);

            // Reset button state
            uploadButton.innerHTML = originalButtonText;
            uploadButton.disabled = false;

            // Show error message
            showImportMessage('Error importing enquiries', 'error');
        });
    }

    // Function to show import message
    function showImportMessage(message, type) {
        const messageElement = document.getElementById('import-message');
        messageElement.textContent = message;
        messageElement.className = `import-message ${type}`;
        messageElement.classList.remove('hidden');

        // Hide the message after 5 seconds
        setTimeout(() => {
            messageElement.classList.add('hidden');
        }, 5000);
    }

    // Function to export enquiries to Excel
    function exportToExcel() {
        // Show loading state
        const exportButton = document.getElementById('export-excel-btn');
        const originalButtonText = exportButton.innerHTML;
        exportButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
        exportButton.disabled = true;

        // Create a download link
        const downloadLink = document.createElement('a');
        downloadLink.href = '/api/enquiries/export-excel';
        downloadLink.target = '_blank';

        // Append to body, click, and remove
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        // Reset button state after a short delay
        setTimeout(() => {
            exportButton.innerHTML = originalButtonText;
            exportButton.disabled = false;
        }, 2000);
    }

    // These functions are already defined above, so we're removing the duplicates

    // Helper function to show notifications
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);

        // Remove notification after 3 seconds
        setTimeout(() => {
            notification.classList.add('fade-out');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 500);
        }, 3000);
    }

    // Add event listeners when the DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize the quotation amount toggle
        toggleQuotationAmount();

        // Initialize filters
        const dateFilter = document.getElementById('date-filter');
        dateFilter.addEventListener('change', handleDateFilterChange);

        // Set today's date as default for date inputs
        const today = new Date();
        const lastMonth = new Date();
        lastMonth.setMonth(lastMonth.getMonth() - 1);

        if (document.getElementById('start-date')) {
            document.getElementById('start-date').value = formatDate(lastMonth);
        }

        if (document.getElementById('end-date')) {
            document.getElementById('end-date').value = formatDate(today);
        }

        // Search input event listener
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
            searchInput.addEventListener('keyup', function(event) {
                // Apply filters on Enter key
                if (event.key === 'Enter') {
                    applyFilters();
                }
            });
        }

        // File upload listener
        const fileInput = document.getElementById('excel-file');
        const fileInfo = document.getElementById('file-upload-info');

        if (fileInput && fileInfo) {
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length > 0) {
                    fileInfo.textContent = fileInput.files[0].name;
                } else {
                    fileInfo.textContent = 'No file selected';
                }
            });
        }
    });
</script>

<style>
    /* Enquiry Container */
    .enquiry-container {
        padding: 20px;
    }

    /* Form Styles */
    .enquiry-form-container {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 30px;
    }

    .form-header {
        margin-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 15px;
    }

    .form-header h3 {
        margin-bottom: 8px;
        color: var(--primary-color);
        font-size: 22px;
        font-weight: 600;
    }

    .form-header p {
        color: #666;
        font-size: 14px;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        flex: 1;
    }

    .form-group.full-width {
        flex: 1 0 100%;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group input[type="date"],
    .form-group textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
    }

    .checkbox-group input[type="checkbox"] {
        margin-right: 10px;
        width: 18px;
        height: 18px;
    }

    .checkbox-group label {
        margin-bottom: 0;
    }

    .form-actions {
        display: flex;
        justify-content: center;
        margin-top: 30px;
    }

    .submit-btn {
        padding: 15px 40px;
        background-color: #4CAF50; /* Bright green color */
        color: white;
        border: 2px solid #388E3C; /* Darker green border */
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .submit-btn:hover {
        background-color: #388E3C; /* Darker green on hover */
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
    }

    .submit-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .submit-btn i {
        font-size: 18px;
    }

    /* Current Enquiries Section */
    .current-enquiries {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }

    .enquiry-header {
        margin-bottom: 20px;
    }

    .enquiry-header h3 {
        color: var(--primary-color);
        font-size: 18px;
    }

    /* Filter Section Styles */
    .filter-section {
        background-color: #f9f9f9;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #eee;
    }

    .filter-row {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .search-box {
        display: flex;
        flex: 1;
        min-width: 250px;
    }

    .search-box input {
        flex: 1;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        font-size: 14px;
    }

    .search-button {
        background-color: #2c3e50;
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        padding: 10px 15px;
        cursor: pointer;
    }

    .filter-group {
        min-width: 180px;
    }

    .filter-select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: white;
        font-size: 14px;
        cursor: pointer;
    }

    .reset-filters-btn {
        background-color: #f1f1f1;
        color: #333;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: background-color 0.2s;
    }

    .reset-filters-btn:hover {
        background-color: #e0e0e0;
    }

    .custom-date-range {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px dashed #ddd;
    }

    .date-inputs {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .date-input-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .date-input {
        padding: 8px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .apply-date-btn {
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 15px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .apply-date-btn:hover {
        background-color: #388E3C;
    }

    /* Search and Action Buttons */
    .search-container {
        display: flex;
        align-items: center;
    }

    .search-container input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        width: 250px;
    }

    .search-btn {
        padding: 8px 12px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
    }

    .export-btn {
        padding: 8px 12px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-success {
        background-color: #4CAF50;
        color: white;
    }

    .btn-success:hover {
        background-color: #45a049;
    }

    .btn-primary {
        background-color: #2196F3;
        color: white;
    }

    .btn-primary:hover {
        background-color: #0b7dda;
    }

    /* Table Styles */
    .enquiry-table-container {
        margin-top: 20px;
        overflow-x: auto;
    }

    .enquiry-table {
        width: 100%;
        border-collapse: collapse;
    }

    .enquiry-table th, .enquiry-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    .enquiry-table th {
        background-color: #2c3e50; /* Dark blue background */
        font-weight: 600;
        color: white; /* White text for better contrast */
        text-transform: uppercase; /* Uppercase text */
        font-size: 14px; /* Slightly smaller font */
        letter-spacing: 0.5px; /* Spacing between letters */
    }

    .table-header {
        box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1); /* Add shadow to header row */
    }

    .enquiry-table tr:hover {
        background-color: #f5f5f5;
    }

    .requirements-cell {
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Status Badge */
    .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }

    .status-success {
        background-color: #e6f4ea;
        color: #137333;
    }

    .status-pending {
        background-color: #fef7e0;
        color: #b06000;
    }

    /* Action Buttons */
    .enquiry-actions {
        width: 100px;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .edit-btn, .delete-btn {
        padding: 5px 8px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        color: white;
        font-size: 14px;
    }

    .edit-btn {
        background-color: #4285F4;
    }

    .delete-btn {
        background-color: #EA4335;
    }

    /* No Data Message */
    .no-data-message {
        text-align: center;
        margin-top: 20px;
        padding: 30px;
    }

    .no-data-icon {
        font-size: 48px;
        color: #ccc;
        margin-bottom: 15px;
    }

    .no-data-message h3 {
        margin-bottom: 10px;
        color: #555;
    }

    .no-data-message p {
        color: #777;
        margin-bottom: 20px;
    }

    /* Modal Styles */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease-out;
    }

    .modal.hidden {
        display: none !important;
    }

    .modal-content {
        background-color: white;
        border-radius: 8px;
        width: 450px;
        max-width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease-out;
        transform: translateY(0);
    }

    #delete-modal .modal-content {
        border: 2px solid #EA4335;
    }

    .modal-header {
        padding: 12px 15px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #delete-modal .modal-header {
        background-color: #EA4335;
        color: white;
        border-bottom: none;
    }

    #delete-modal .modal-header h3 {
        color: white;
        font-weight: 600;
    }

    .modal-header h3 {
        margin: 0;
        font-size: 18px;
    }

    .modal-header .close {
        font-size: 24px;
        cursor: pointer;
        color: #777;
    }

    #delete-modal .modal-header .close {
        color: white;
    }

    .modal-body {
        padding: 15px 20px;
    }

    #delete-modal .modal-body {
        padding: 30px 25px;
    }

    #delete-modal .modal-body p {
        font-size: 16px;
        margin-bottom: 15px;
    }

    #delete-customer-name {
        font-weight: 600;
    }

    .modal-footer {
        padding: 10px 15px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    #delete-modal .modal-footer {
        border-top-color: #f0f0f0;
        padding: 20px;
    }

    .warning-text {
        color: #EA4335;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .warning-text:before {
        content: "⚠️";
        font-size: 18px;
    }

    .cancel-btn {
        padding: 10px 20px;
        background-color: #f1f1f1;
        color: #333;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s;
    }

    .cancel-btn:hover {
        background-color: #e0e0e0;
    }

    .delete-confirm-btn {
        padding: 10px 20px;
        background-color: #EA4335;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s, transform 0.1s;
    }

    .delete-confirm-btn:hover {
        background-color: #d32f2f;
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .delete-confirm-btn:active {
        transform: translateY(0);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* Success and Error Messages */
    .success-message, .error-message {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        animation: slideIn 0.3s ease-out, fadeOut 0.5s ease-out 4.5s forwards;
        max-width: 80%;
    }

    .success-message {
        background-color: #e6f4ea;
        color: #137333;
        border-left: 4px solid #34A853;
    }

    .error-message {
        background-color: #fce8e6;
        color: #c5221f;
        border-left: 4px solid #EA4335;
    }

    .success-icon, .error-icon {
        font-size: 18px;
        font-weight: bold;
    }

    .close-message {
        margin-left: auto;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .close-message:hover {
        opacity: 1;
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
        }
        to {
            opacity: 0;
            visibility: hidden;
        }
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    /* Edit Mode Styles */
    .edit-content {
        width: 100%;
    }

    .edit-input {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #4285F4;
        border-radius: 4px;
        font-size: 14px;
    }

    .save-btn {
        background-color: #34A853;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 8px;
        cursor: pointer;
    }

    .cancel-edit {
        background-color: #EA4335 !important;
    }

    /* Search Panel Styles */
    .search-panel {
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .search-results {
        margin-top: 15px;
    }

    .search-results-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .search-result-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
    }

    .search-result-item:last-child {
        border-bottom: none;
    }

    .search-result-info {
        display: flex;
        flex-direction: column;
    }

    .search-result-number {
        font-weight: 500;
        color: #555;
    }

    .search-result-name {
        color: #777;
    }

    .no-results {
        text-align: center;
        padding: 20px;
        color: #777;
    }

    .loading-spinner {
        text-align: center;
        padding: 20px;
        color: #777;
    }

    /* Import Modal Styles */
    .required-columns {
        background-color: #f9f9f9;
        padding: 8px 12px;
        border-radius: 4px;
        margin: 8px 0;
        columns: 3;
        font-size: 13px;
    }

    .required-columns li {
        margin-bottom: 4px;
        font-family: monospace;
        background-color: #f5f5f5;
        padding: 1px 4px;
        border-radius: 3px;
        display: inline-block;
        margin-right: 4px;
        font-size: 12px;
    }

    .import-instructions {
        margin: 10px 0;
        font-size: 13px;
        padding: 8px 10px;
        background-color: #fff9c4;
        border-radius: 4px;
        border-left: 4px solid #fbc02d;
    }

    .import-instructions p {
        margin: 4px 0;
    }

    .template-info {
        margin: 10px 0;
        font-style: italic;
        padding: 8px 10px;
        background-color: #e3f2fd;
        border-radius: 4px;
        border-left: 4px solid #2196F3;
        font-size: 13px;
    }

    .template-info a {
        color: #0d47a1;
        text-decoration: none;
        font-weight: 500;
    }

    .template-info a:hover {
        text-decoration: underline;
    }

    .file-upload-container {
        margin: 12px 0;
        padding: 10px;
        border: 1px dashed #ddd;
        border-radius: 4px;
        text-align: center;
        background-color: #f9f9f9;
    }

    .file-upload-info {
        margin: 6px 0;
        font-weight: 500;
        font-style: italic;
        color: #666;
        font-size: 13px;
    }

    .file-types {
        font-size: 11px;
        color: #777;
        margin-top: 2px;
    }

    .import-message {
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
    }

    .import-message.success {
        background-color: #e6f4ea;
        color: #137333;
        border: 1px solid #c8e6c9;
    }

    .import-message.error {
        background-color: #fce8e6;
        color: #c5221f;
        border: 1px solid #ffcdd2;
    }

    .import-message.hidden {
        display: none;
    }

    .download-template-btn {
        display: block;
        width: 100%;
        padding: 10px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
    }

    /* Pagination Styles */
    .pagination-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }

    .pagination {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .pagination-btn {
        padding: 6px 12px;
        background-color: #f1f1f1;
        color: #333;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
    }

    .pagination-btn:hover {
        background-color: #e0e0e0;
    }

    .pagination-btn.disabled {
        background-color: #f9f9f9;
        color: #aaa;
        cursor: not-allowed;
    }

    .pagination-info {
        font-size: 14px;
        color: #555;
    }

    .pagination-options {
        display: flex;
        align-items: center;
    }

    .items-per-page-form {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .items-per-page-form label {
        font-size: 14px;
        color: #555;
    }

    .items-per-page-form select {
        padding: 5px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: white;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        .form-row {
            flex-direction: column;
            gap: 10px;
        }

        .enquiry-header {
            flex-direction: column;
            gap: 15px;
        }

        .search-container input {
            width: 100%;
        }

        .pagination-controls {
            flex-direction: column;
            gap: 15px;
        }

        .required-columns {
            columns: 1;
        }
    }

    /* Notification styles */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 4px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        z-index: 1000;
        animation: slide-in 0.3s ease-out;
    }

    .notification.success {
        border-left: 4px solid #28a745;
    }

    .notification.error {
        border-left: 4px solid #dc3545;
    }

    .notification.info {
        border-left: 4px solid #17a2b8;
    }

    .notification i {
        margin-right: 10px;
        font-size: 18px;
    }

    .notification.success i {
        color: #28a745;
    }

    .notification.error i {
        color: #dc3545;
    }

    .notification.info i {
        color: #17a2b8;
    }

    .notification.fade-out {
        opacity: 0;
        transition: opacity 0.5s;
    }

    @keyframes slide-in {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
</style>
{% endblock %}









